# Projekt bazy danych

## Diagram tabel oraz ich relacji
![Projekt bazy](../../images/db-schema.png)

## Opisy pól

### MessageTypes
| Nazwa | Typ     | Opis                                                  | Właściwości i ograniczenia                                  | PK                          | FK  |
| ----- | ------- | ----------------------------------------------------- | ----------------------------------------------------------- | --------------------------- | --- |
| id    | bigint  | Klucz główny tabeli.                                  | autoinkrementowane, unikalne, nie-null                      | ![](../../images/check.png) |     |
| type  | varchar | Ciąg znaków identyfikujący typ zawartości wiadomości. | nie-null, musi mieć wartość z listy dopuszczalnych wartości |                             |     |
  ----

### Messages
| Nazwa     | Typ       | Opis                                                                                                                 | Właściwości i ograniczenia                                                             | PK                          | FK                          |
| --------- | --------- | -------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- | --------------------------- | --------------------------- |
| id        | bigint    | Klucz główny tabeli.                                                                                                 | autoinkrementowane, unikalne, nie-null                                                 | ![](../../images/check.png) |                             |
| contactId | bigint    | Klucz obcy relacji wiele do jednego z tabelą Contacts.                                                               | nie-null, w tabeli Contacts musi istnieć klucz główny o korespondującej wartości       |                             | ![](../../images/check.png) |
| typeId    | bigint    | Klucz obcy relacji wiele do jednego z tabelą MessageTypes. Określa typ i format zawartości zapisanej w polu content. | nie-null, w tabeli MessageTypes musi istnieć klucz główny o odpowiadającej mu wartości |                             | ![](../../images/check.png) |
| content   | text      | Zawartość wiadomości. Korzysta z kodowania znaków UTF-8.                                                             | nie-puste                                                                              |                             |                             |
| time      | timestamp | Data i godzina (z dokładnością do sekund) wysłania wiadomości. Nie uwzględnia stref czasowych.                       | nie-null, nie może różnić się o więcej niż minutę od chwili wpisania do bazy           |                             |                             |
  ----

### Contacts
| Nazwa            | Typ    | Opis                                                                                                    | Właściwości i ograniczenia                                                                                                                                                                                                                                                                   | PK                          | FK                          |
| ---------------- | ------ | ------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------- | --------------------------- |
| id               | bigint | Klucz główny tabeli.                                                                                    | autoinkrementowane, unikalne, nie-null                                                                                                                                                                                                                                                       | ![](../../images/check.png) |                             |
| userId           | bigint | Klucz obcy relacji wiele do jednego z tabelą Users. Określa właściciela kontaktu.                       | nie-null, w tabeli Users musi istnieć klucz główny o korespondującej wartości                                                                                                                                                                                                                |                             | ![](../../images/check.png) |
| contactId        | bigint | Klucz obcy relacji wiele do jednego z tabelą Users. Określa użytkownika będącego obiektem kontaktu.     | nie-null, w tabeli Users musi istnieć klucz główny o odpowiadającej mu wartości                                                                                                                                                                                                              |                             | ![](../../images/check.png) |
| isLocationShared | bit    | Przechowuje stan współdzielenia lokalizacji (włączone/wyłączone) przez właściciela do obiektu kontaktu. | nie-null, domyślna wartośc 0 (fałsz)                                                                                                                                                                                                                                                         |                             |                             |
| isBlocked        | bit    | Przechowuje stan blokady obiektu kontaktu B przez właściciela A.                                        | nie-null, domyślna wartość 0                                                                                                                                                                                                                                                                 |                             |                             |
| isAccepted       | bit    | Przechowuje stan akceptacji prośby o kontakt (oczekująca/zaakceptowana)                                 | nie-null, domyślna wartość 0 (fałsz), zmiana wartości na 1 (prawda) w rekordzie opisującym kontakt między właścicielem A a obiektem kontaktu B powoduje utworzenie nowego rekordu opisującego kontakt między właścicielem B a obiektem kontaktu A (z wartością 1 (prawda) w polu isAccepted) |                             |                             |
    
  ----
### Users
| Nazwa                 | Typ       | Opis                                                        | Właściwości i ograniczenia                                                          | PK                          | FK  |
| --------------------- | --------- | ----------------------------------------------------------- | ----------------------------------------------------------------------------------- | --------------------------- | --- |
| id                    | bigint    | Klucz główny tabeli.                                        | autoinkrementowane, unikalne, nie-null                                              | ![](../../images/check.png) |     |
| phoneNumer            | varchar   | Numer telefonu użytkownika powiązany z kontem.              | unikalne, nie-null, nie-puste, sprawdzane pod kątem zgodności wyrażeniem regularnym |                             |     |
| email                 | varchar   | Adres email użytkownika powiązany z kontem.                 | unikalne, nie-null, nie-puste, sprawdzane pod kątem zgodności wyrażeniem regularnym |                             |     |
| passwordHash          | varchar   | Zasolony i popieprzony hash hasła użytkownika.              | określona długość, nie-null, nie-puste                                              |                             |     |
| lastLocation          | varchar   | Ciąg znaków określający lokalizację użytkownika.            | zmiana zawartości wyzwala aktualizację pola lastLocationTimestamp                   |                             |     |
| lastLocationTimestamp | timestamp | Data i czas ostatniej aktualizacji lokalizacji użytkownika. | aktualizowane automatycznie w momencie zmiany zawartości pola lastLocation.         |                             |     |
| lastLoginTimestamp    | timestamp | Data i czas ostatniego logowania użytkownika.               |                                                                                     |                             |     |
  
  ----
### Token
| Nazwa               | Typ       | Opis                                                                                                                                                                                             | Właściwości i ograniczenia                                                                                                                                                            | PK                          | FK                          |
| ------------------- | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------- | --------------------------- |
| id                  | bigint    | Klucz główny tabeli.                                                                                                                                                                             | autoinkrementowane, unikalne, nie-null                                                                                                                                                | ![](../../images/check.png) |                             |
| userId              | bigint    | Klucz obcy relacji wiele do jednego z tabelą Users. Określa właściciela tokenu.                                                                                                                  | nie-null, w tabeli Users musi istnieć klucz główny o korespondującej wartości                                                                                                         |                             | ![](../../images/check.png) |
| token               | varchar   | Token służący do weryfikacji autentyczności zapytań z wysyłanych klienta oraz przechowywania logowania użytkownika.                                                                              | nie-null, nie-pusty, unikalny                                                                                                                                                         |                             |                             |
| generatedTimestamp  | timestamp | Określa moment wygenerowania tokenu. Nie uwzględnia stref czasowych.                                                                                                                             | nie-null, nie może różnić się o więcej niż minutę od chwili wpisania do bazy, okresowo porównywany do aktualnego czasu i usuwany jeśli określa czas przeszły w stosunku do aktualnego |                             |                             |
| expirationTimestamp | timestamp | Określa datę i czas wygaśnięcia tokenu. Nie uwzględnia stref czasowych.                                                                                                                          | nie-null, musi opisywać moment przyszły w stosunku do chwili wpisania do bazy                                                                                                         |                             |                             |
| isExpired           | bit       | Przechowuje informację o wygaśnięciu tokenu (przedwczesne wygaśnięcie następuje w wyniku wylogowania się użytkownika). Wygaśnięte tokeny muszą być przechowywane na wypadek próby podszycia się. | nie-null, domyślna wartość 0 (fałsz)                                                                                                                                                  |                             |                             |
  ----
## Opis relacji

## Opis mechanizmów bazy danych